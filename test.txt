CONSTRAINTS (updated):
- Recv DH-ratchet cycles automatically when a message arrives with a new remote pubkey.
- Send DH-ratchet cycles automatically on the first send after you’ve recv-ratcheted.
- Each side may have AT MOST ONE (lost) outstanding at any time (but Alice and Bob CAN have one lost simultaneously).
- You CANNOT lose the very first message of the entire conversation: A0 must NOT be (lost).
- You CAN lose the first message of a later chain/run (e.g., B0 can be lost; A1 can be lost, etc).

========================================================
TEST 1 — Basic skip + recover (A-run), A0 not lost
A0
A1 (lost)
A2
(recovered A1)

PASS

========================================================
TEST 2 — Skip on A-run, B interleaves, then recover
A0
A1
A2 (lost)
B0
A3
(recovered A2)

========================================================
TEST 3 — Lose B0 (first of B-run is allowed), then recover
A0
B0 (lost)
A1
B1
(recovered B0)

========================================================
TEST 4 — Simultaneous one-loss-per-side (overlapping outstanding losses)
A0
A1 (lost)
B0 (lost)
A2
B1
(recovered A1)
(recovered B0)

========================================================
TEST 5 — Simultaneous losses, but recover in opposite order (forces correct key lookup)
A0
A1 (lost)
B0 (lost)
A2
B1
(recovered B0)
(recovered A1)

========================================================
TEST 6 — Your core pattern + delayed recovery
A0
A1
B0
B1
A2 (lost)
B2
B3
A3
(recovered A2)

========================================================
TEST 7 — Long-gap recovery (skip stays valid across direction changes)
A0
A1
A2 (lost)
B0
B1
A3
B2
A4
(recovered A2)

========================================================
TEST 8 — Stale recovery after multiple later decrypts (still only one loss on A side)
A0
A1
A2 (lost)
A3
A4
B0
B1
(recovered A2)

========================================================
TEST 9 — B-side stale recovery after multiple later decrypts (lose B0 allowed)
A0
B0 (lost)
B1
B2
A1
A2
(recovered B0)

========================================================
TEST 10 — Swap which side loses first; still never lose A0
A0
B0
A1 (lost)
B1 (lost)
A2
B2
(recovered A1)
(recovered B1)
